<nav th:fragment="navbarFragment" class="bg-black text-white border-b border-gray-800"
     xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <a href="/" class="text-white text-xl">
            <img src="/dulgi.png" alt="로고" class="h-8 w-auto inline">
        </a>
        <div>
            <a class="dropbtn bg-black text-white text-lg" th:href="@{/notice/list}">공지사항</a>
        </div>
        <div class="dropdown">
            <button class="dropbtn bg-black text-white text-lg">소개</button>
            <div class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52 bg-black text-white">
                <a class="nav-link inline-block py-2 px-4 text-white no-underline border-b border-gray-500"
                   th:href="@{/trainer/list}">트레이너 프로필</a>
                <a class="nav-link inline-block py-2 px-4 text-white no-underline" th:href="@{/map}">관련 업체 지도</a>
            </div>
        </div>
        <div>
            <a class="dropbtn bg-black text-white text-lg" th:href="@{/totalPass/list}">이용권 구매</a>
        </div>
        <div>
            <a class="dropbtn bg-black text-white text-lg" th:href="@{/challenge/challenges}">챌린지</a>
        </div>
        <div>
            <a class="dropbtn bg-black text-white text-lg" th:href="@{/wod/form}">오운완</a>
        </div>
        <div class="flex-none gap-2">
            <div class="dropdown dropdown-end">
                <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                    <div class="w-10 rounded-full">
                        <img alt="Tailwind CSS Navbar component"
                             src="/1715046707.gif" loop=infinite/>
                    </div>
                </div>
                <ul tabindex="0"
                    class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52 text-black">
                    <li class="nav-item">
                        <a class="nav-link" sec:authorize="isAuthenticated()" th:href="@{/user/profile}">프로필</a>
                    </li>
                    <li sec:authorize="isAuthenticated()">
                        <a th:href="@{/user/logout}">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script th:inline="javascript">

        // 쿠키에서 로그인 정보 가져오기
     function getLoggedInUser() {
    
        const aa = /*[[${#authentication}]]*/ null;
    
        if(aa.name === "anonymousUser") {
            return null;
        }
    
        return aa.name;
    
     }
    
     // 현재 로그인된 사용자 확인 및 웹소켓 연결
     function connectIfLoggedIn() {
         var loggedInUser = getLoggedInUser();
         if (loggedInUser != null) {
             console.log('로그인된 아이디는' + loggedInUser);
    
             connectWebSocket(loggedInUser);
         } else {
             console.log('로그인되지 않은 상태입니다.');
         }
     }
    
     // 웹소켓 연결
     function connectWebSocket(loggedInUser) {
         var socket = new SockJS("http://localhost:8088/ws-stomp");
         var stompClient = Stomp.over(socket);
         stompClient.connect({}, function (frame) {
             console.log('웹소켓 연결 성공:', frame);
             var user = getLoggedInUser();
             // 연결 후 추가 작업 수행
             stompClient.subscribe('/sub/alarm/' + user , function (alarmDto) {
                showAlarm(JSON.parse(alarmDto.body));
             });
         }, function (error) {
             console.error('웹소켓 연결 실패:', error);
         });
     }
    
    
         function showAlarm(alarmDto) {
                    $("#alarm").append(
                      "<li>" +
            "<a href='/user/alarmCheck/" + alarmDto.chatRoomId + "'>" +
            alarmDto.sendUsername + "님의 메세지 : " + alarmDto.message +
            "</a>" +
        "</li>"
                    );
                    $("#toast").append(
                    toastr.info(alarmDto.sendUsername + '님의 메세지 : ' + alarmDto.message)
                    );
    
            }
    
     // 페이지 로드 후 실행되는 부분
     document.addEventListener('DOMContentLoaded', function() {
     // 페이지 로드 시 로그인 여부를 확인하고 웹소켓에 연결
         connectIfLoggedIn();
     });
    
    </script>
</nav>