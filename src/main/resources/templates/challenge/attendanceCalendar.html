<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>출석 이벤트</title>
    <style>
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .day {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            position: relative;
        }
        .stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }
        .attendance-button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            font-size: 16px;
        }
    </style>
</head>
<body>
<div class="container" style="border: 2px solid white; padding: 40px; width: 500px; margin: 20px auto;">
    <h1>출석 이벤트</h1>
    <div id="calendar" class="calendar"></div>
    <button id="attendanceButton" class="attendance-button">출석하기</button>
</div>

<script>
    // 현재 날짜 가져오기
    const today = new Date();
    const currentMonth = today.getMonth();
    const currentYear = today.getFullYear();

    // 달력 생성 함수
    function generateCalendar(month, year) {
        const calendar = document.getElementById('calendar');
        calendar.innerHTML = '';

        // 달의 첫 날과 마지막 날 가져오기
        const firstDay = new Date(year, month).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        // 빈 칸 채우기
        for (let i = 0; i < firstDay; i++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'day';
            calendar.appendChild(dayElement);
        }

        // 날짜 채우기
        for (let date = 1; date <= lastDate; date++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'day';
            dayElement.textContent = date;

            // 클릭 이벤트 추가
            dayElement.addEventListener('click', () => markAttendance(dayElement, year, month, date));

            calendar.appendChild(dayElement);
        }
    }

    // 출석 표시 함수
    function markAttendance(dayElement, year, month, date) {
        const attendanceDate = new Date(year, month, date);
        const existingStamp = dayElement.querySelector('.stamp');

        if (existingStamp) {
            dayElement.removeChild(existingStamp);
        } else {
            const stamp = document.createElement('div');
            stamp.className = 'stamp';

            const img = document.createElement('img');
            img.src = 'https://i.imgur.com/AEGEIjA.png'; // 이미지 경로를 여기에 입력하세요
            img.alt = 'Attendance Stamp';
            img.style.width = '50px'; // 이미지 크기를 적절히 조정하세요
            img.style.height = '50px'; // 이미지 크기를 적절히 조정하세요

            stamp.appendChild(img);
            dayElement.appendChild(stamp);

            // 출석 데이터를 서버에 저장하는 코드 추가
            fetch(`/attendance/checkin`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            }).then(response => {
                if (!response.ok) {
                    return response.text().then(text => { throw new Error(text) });
                }
                return response.text();
            }).then(data => {
                console.log('출석 체크 성공:', data);
            }).catch(error => {
                console.error('출석 체크 실패:', error);
            });
        }
    }

    // "출석하기" 버튼 클릭 이벤트 핸들러 추가
    document.getElementById('attendanceButton').addEventListener('click', () => {
        const todayElement = Array.from(document.querySelectorAll('.day')).find(dayElement => {
            return dayElement.textContent == today.getDate();
        });

        if (todayElement) {
            markAttendance(todayElement, currentYear, currentMonth, today.getDate());
        }
    });

    // 달력 초기 생성
    generateCalendar(currentMonth, currentYear);
</script>
</body>
</html>
